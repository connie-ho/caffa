{"ast":null,"code":"import _regeneratorRuntime from\"/home/kevin/lighthouse/caffa-deploy/caffa/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/kevin/lighthouse/caffa-deploy/caffa/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/kevin/lighthouse/caffa-deploy/caffa/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{React,useState,useEffect,useContext}from\"react\";import Button from\"@material-ui/core/Button\";import Dialog from\"@material-ui/core/Dialog\";import{makeStyles}from\"@material-ui/core\";import DialogActions from\"@material-ui/core/DialogActions\";import DialogContent from\"@material-ui/core/DialogContent\";import Typography from\"@material-ui/core/Typography\";import DialogTitle from\"@material-ui/core/DialogTitle\";import CircularProgress from\"@material-ui/core/CircularProgress\";import UploadForm from\"./UploadForm\";import{projectStorage}from\"../../firebase/config\";import{googleImageDetection}from\"./helpers\";import{useHistory}from\"react-router-dom\";import SearchContext from\"../../contexts/SearchContext\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function FormDialog(props){var _useContext=useContext(SearchContext),results=_useContext.results,setResults=_useContext.setResults;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),uploadFile=_useState4[0],setUploadFile=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),url=_useState10[0],setUrl=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),textArray=_useState12[0],setTextArray=_useState12[1];var history=useHistory();useEffect(function(){if(uploadFile){setLoading(true);var storageRef=projectStorage.ref(uploadFile.name);storageRef.put(uploadFile).on(\"state_changed\",function(snap){},function(err){setError(err);},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,textArray;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return storageRef.getDownloadURL();case 2:url=_context.sent;_context.next=5;return googleImageDetection(url);case 5:textArray=_context.sent;setUrl(url);setTextArray(textArray);_context.next=10;return setResults({url:url,textArray:textArray});case 10:localStorage.setItem(\"url\",url);localStorage.setItem(\"textarray\",textArray);setLoading(false);history.push(\"/search\");setOpen(false);case 15:case\"end\":return _context.stop();}}},_callee);})));}},[uploadFile]);var open=props.open,setOpen=props.setOpen;var handleClose=function handleClose(){setOpen(false);};var uploadAndSearch=function uploadAndSearch(file){if(file){setUploadFile(file);}else{setError(\"File not selected\");}};var useStyles=makeStyles({centreAlignDialogActions:{justifyContent:\"center\"},paper:{overflow:\"auto\",maxHeight:\"700px\",height:450,width:400,alignItems:\"center\"},content:{overflow:\"auto\",display:\"flex\",flexDirection:\"column\",justifyContent:\"space-between\",height:300,width:300,alignItems:\"center\",border:\"1px dotted black\"},loading:{transform:\"translate(0em, 0rem)\"},dialogTitle:{root:{fontSize:\"2em\"}}});var classes=useStyles();return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Dialog,{classes:{paper:classes.paper},open:open,onClose:handleClose,\"aria-labelledby\":\"form-dialog-title\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"form-dialog-title\",children:/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",style:{fontSize:\"1.5em\"},children:[\" \",\"Image Search\",\" \"]})}),/*#__PURE__*/_jsxs(DialogContent,{className:classes.content,children:[/*#__PURE__*/_jsx(UploadForm,{file:file,setFile:setFile,error:error,setError:setError,loading:loading}),loading&&/*#__PURE__*/_jsx(CircularProgress,{color:\"primary\",style:{position:\"center\"}})]}),/*#__PURE__*/_jsxs(DialogActions,{classes:{root:classes.centreAlignDialogActions},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:handleClose,style:{fontSize:\"1.0em\",margin:\"0.5rem\"},color:\"primary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:function onClick(){uploadAndSearch(file);},style:{fontSize:\"1.0em\",margin:\"0.5rem\"},color:\"primary\",children:\"Search\"})]})]})});}","map":{"version":3,"sources":["/home/kevin/lighthouse/caffa-deploy/caffa/frontend/src/components/image-search/ImageSearchModal.js"],"names":["React","useState","useEffect","useContext","Button","Dialog","makeStyles","DialogActions","DialogContent","Typography","DialogTitle","CircularProgress","UploadForm","projectStorage","googleImageDetection","useHistory","SearchContext","FormDialog","props","results","setResults","file","setFile","uploadFile","setUploadFile","error","setError","loading","setLoading","url","setUrl","textArray","setTextArray","history","storageRef","ref","name","put","on","snap","err","getDownloadURL","localStorage","setItem","push","setOpen","open","handleClose","uploadAndSearch","useStyles","centreAlignDialogActions","justifyContent","paper","overflow","maxHeight","height","width","alignItems","content","display","flexDirection","border","transform","dialogTitle","root","fontSize","classes","position","margin"],"mappings":"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","sourcesContent":["import { React, useState, useEffect, useContext } from \"react\";\nimport Button from \"@material-ui/core/Button\";\nimport Dialog from \"@material-ui/core/Dialog\";\nimport { makeStyles } from \"@material-ui/core\";\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport Typography from \"@material-ui/core/Typography\";\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport UploadForm from \"./UploadForm\";\nimport { projectStorage } from \"../../firebase/config\";\nimport { googleImageDetection } from \"./helpers\";\nimport { useHistory } from \"react-router-dom\";\nimport SearchContext from \"../../contexts/SearchContext\";\n\nexport default function FormDialog(props) {\n  const { results, setResults } = useContext(SearchContext);\n  const [file, setFile] = useState(null);\n  const [uploadFile, setUploadFile] = useState(null);\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [url, setUrl] = useState(null);\n  const [textArray, setTextArray] = useState([]);\n  const history = useHistory();\n\n  useEffect(() => {\n    if (uploadFile) {\n      setLoading(true);\n\n      const storageRef = projectStorage.ref(uploadFile.name);\n      storageRef.put(uploadFile).on(\n        \"state_changed\",\n        (snap) => {},\n        (err) => {\n          setError(err);\n        },\n        async () => {\n          const url = await storageRef.getDownloadURL();\n          const textArray = await googleImageDetection(url);\n\n          setUrl(url);\n          setTextArray(textArray);\n\n          await setResults({\n            url,\n            textArray: textArray,\n          });\n\n          localStorage.setItem(\"url\", url);\n          localStorage.setItem(\"textarray\", textArray);\n\n          setLoading(false);\n          history.push(\"/search\");\n          setOpen(false);\n        }\n      );\n    }\n  }, [uploadFile]);\n\n  const { open, setOpen } = props;\n\n  const handleClose = () => {\n    setOpen(false);\n  };\n\n  const uploadAndSearch = (file) => {\n    if (file) {\n      setUploadFile(file);\n    } else {\n      setError(\"File not selected\");\n    }\n  };\n\n  const useStyles = makeStyles({\n    centreAlignDialogActions: {\n      justifyContent: \"center\",\n    },\n    paper: {\n      overflow: \"auto\",\n      maxHeight: \"700px\",\n      height: 450,\n      width: 400,\n      alignItems: \"center\",\n    },\n    content: {\n      overflow: \"auto\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      justifyContent: \"space-between\",\n      height: 300,\n      width: 300,\n      alignItems: \"center\",\n      border: \"1px dotted black\",\n    },\n    loading: {\n      transform: `translate(0em, 0rem)`,\n    },\n    dialogTitle: {\n      root: {\n        fontSize: \"2em\",\n      },\n    },\n  });\n\n  const classes = useStyles();\n\n  return (\n    <div>\n      <Dialog\n        classes={{ paper: classes.paper }}\n        open={open}\n        onClose={handleClose}\n        aria-labelledby=\"form-dialog-title\"\n      >\n        <DialogTitle id=\"form-dialog-title\">\n          <Typography variant=\"h6\" style={{ fontSize: \"1.5em\" }}>\n            {\" \"}\n            Image Search{\" \"}\n          </Typography>\n        </DialogTitle>\n        <DialogContent className={classes.content}>\n          <UploadForm\n            file={file}\n            setFile={setFile}\n            error={error}\n            setError={setError}\n            loading={loading}\n          />\n          {loading && (\n            <CircularProgress color=\"primary\" style={{ position: \"center\" }} />\n          )}\n        </DialogContent>\n\n        <DialogActions classes={{ root: classes.centreAlignDialogActions }}>\n          <Button\n            variant=\"outlined\"\n            onClick={handleClose}\n            style={{ fontSize: \"1.0em\", margin: \"0.5rem\" }}\n            color=\"primary\"\n          >\n            Cancel\n          </Button>\n          <Button\n            variant=\"outlined\"\n            onClick={() => {\n              uploadAndSearch(file);\n            }}\n            style={{ fontSize: \"1.0em\", margin: \"0.5rem\" }}\n            color=\"primary\"\n          >\n            Search\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}